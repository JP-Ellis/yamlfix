<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=Lyz><link href=https://lyz-code.github.io/yamlfix/ rel=canonical><link rel=icon href=assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.3.9"><title>yamlfix</title><link rel=stylesheet href=assets/stylesheets/main.1d29e8d0.min.css><link rel=stylesheet href=assets/stylesheets/palette.cbb835fc.min.css><meta name=theme-color content=#546d78><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=css/timeago.css><link rel=stylesheet href=assets/_mkdocstrings.css><link rel=stylesheet href=stylesheets/extra.css><link rel=stylesheet href=stylesheets/links.css><script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=blue-grey data-md-color-accent=light-blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#installing class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=. title=yamlfix class="md-header__button md-logo" aria-label=yamlfix data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> yamlfix </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> yamlfix </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/lyz-code/yamlfix title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> lyz-code/yamlfix </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=. title=yamlfix class="md-nav__button md-logo" aria-label=yamlfix data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> yamlfix </label> <div class=md-nav__source> <a href=https://github.com/lyz-code/yamlfix title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> lyz-code/yamlfix </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> yamlfix <span class="md-nav__icon md-icon"></span> </label> <a href=. class="md-nav__link md-nav__link--active"> yamlfix </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#installing class=md-nav__link> Installing </a> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> Usage </a> </li> <li class=md-nav__item> <a href=#features class=md-nav__link> Features </a> </li> <li class=md-nav__item> <a href=#configuration class=md-nav__link> Configuration </a> <nav class=md-nav aria-label=Configuration> <ul class=md-nav__list> <li class=md-nav__item> <a href=#auto-configure-through-pyprojecttoml class=md-nav__link> Auto-Configure through pyproject.toml </a> </li> <li class=md-nav__item> <a href=#provide-config-files class=md-nav__link> Provide config-files </a> </li> <li class=md-nav__item> <a href=#configure-environment-prefix class=md-nav__link> Configure environment prefix </a> </li> <li class=md-nav__item> <a href=#configuration-options class=md-nav__link> Configuration Options </a> <nav class=md-nav aria-label="Configuration Options"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#allow-duplicate-keys class=md-nav__link> Allow Duplicate Keys </a> </li> <li class=md-nav__item> <a href=#config-path class=md-nav__link> Config Path </a> </li> <li class=md-nav__item> <a href=#explicit-document-start class=md-nav__link> Explicit Document Start </a> </li> <li class=md-nav__item> <a href=#flow-style-sequence-lists class=md-nav__link> Flow-Style Sequence (Lists) </a> </li> <li class=md-nav__item> <a href=#indentation class=md-nav__link> Indentation </a> </li> <li class=md-nav__item> <a href=#line-length-width class=md-nav__link> Line Length (Width) </a> </li> <li class=md-nav__item> <a href=#none-representation class=md-nav__link> None Representation </a> </li> <li class=md-nav__item> <a href=#quote-basic-values class=md-nav__link> Quote Basic Values </a> </li> <li class=md-nav__item> <a href=#quote-keys-and-basic-values class=md-nav__link> Quote Keys and Basic Values </a> </li> <li class=md-nav__item> <a href=#quote-representation class=md-nav__link> Quote Representation </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> <li class=md-nav__item> <a href=#contributing class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href=#donations class=md-nav__link> Donations </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=editor_integration/ class=md-nav__link> Editor Integration </a> </li> <li class=md-nav__item> <a href=reference/ class=md-nav__link> Reference </a> </li> <li class=md-nav__item> <a href=contributing/ class=md-nav__link> Contributing </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#installing class=md-nav__link> Installing </a> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> Usage </a> </li> <li class=md-nav__item> <a href=#features class=md-nav__link> Features </a> </li> <li class=md-nav__item> <a href=#configuration class=md-nav__link> Configuration </a> <nav class=md-nav aria-label=Configuration> <ul class=md-nav__list> <li class=md-nav__item> <a href=#auto-configure-through-pyprojecttoml class=md-nav__link> Auto-Configure through pyproject.toml </a> </li> <li class=md-nav__item> <a href=#provide-config-files class=md-nav__link> Provide config-files </a> </li> <li class=md-nav__item> <a href=#configure-environment-prefix class=md-nav__link> Configure environment prefix </a> </li> <li class=md-nav__item> <a href=#configuration-options class=md-nav__link> Configuration Options </a> <nav class=md-nav aria-label="Configuration Options"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#allow-duplicate-keys class=md-nav__link> Allow Duplicate Keys </a> </li> <li class=md-nav__item> <a href=#config-path class=md-nav__link> Config Path </a> </li> <li class=md-nav__item> <a href=#explicit-document-start class=md-nav__link> Explicit Document Start </a> </li> <li class=md-nav__item> <a href=#flow-style-sequence-lists class=md-nav__link> Flow-Style Sequence (Lists) </a> </li> <li class=md-nav__item> <a href=#indentation class=md-nav__link> Indentation </a> </li> <li class=md-nav__item> <a href=#line-length-width class=md-nav__link> Line Length (Width) </a> </li> <li class=md-nav__item> <a href=#none-representation class=md-nav__link> None Representation </a> </li> <li class=md-nav__item> <a href=#quote-basic-values class=md-nav__link> Quote Basic Values </a> </li> <li class=md-nav__item> <a href=#quote-keys-and-basic-values class=md-nav__link> Quote Keys and Basic Values </a> </li> <li class=md-nav__item> <a href=#quote-representation class=md-nav__link> Quote Representation </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> <li class=md-nav__item> <a href=#contributing class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href=#donations class=md-nav__link> Donations </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/lyz-code/yamlfix/edit/master/docs/index.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1>yamlfix</h1> <p><a href=https://github.com/lyz-code/yamlfix/actions><img alt="Actions Status" src=https://github.com/lyz-code/yamlfix/workflows/Tests/badge.svg></a> <a href=https://github.com/lyz-code/yamlfix/actions><img alt="Actions Status" src=https://github.com/lyz-code/yamlfix/workflows/Build/badge.svg></a> <a href="https://coveralls.io/github/lyz-code/yamlfix?branch=main"><img alt="Coverage Status" src="https://coveralls.io/repos/github/lyz-code/yamlfix/badge.svg?branch=main"></a></p> <p>A simple opinionated yaml formatter that keeps your comments!</p> <h2 id=installing>Installing<a class=headerlink href=#installing title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code>pip install yamlfix
</code></pre></div> <h2 id=usage>Usage<a class=headerlink href=#usage title="Permanent link">&para;</a></h2> <p>Imagine we've got the following source code:</p> <div class=highlight><pre><span></span><code><span class=nt>book_library</span><span class=p>:</span><span class=w></span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>title</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Why we sleep</span><span class=w></span>
<span class=w>  </span><span class=nt>author</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Matthew Walker</span><span class=w></span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>title</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Harry Potter and the Methods of Rationality</span><span class=w></span>
<span class=w>  </span><span class=nt>author</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Eliezer Yudkowsky</span><span class=w></span>
</code></pre></div> <p>It has the following errors:</p> <ul> <li>There is no <code>---</code> at the top.</li> <li>The indentation is all wrong.</li> </ul> <p>After running <code>yamlfix</code> the resulting source code will be:</p> <div class=highlight><pre><span></span><code><span class=nt>book_library</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>title</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Why we sleep</span><span class=w></span>
<span class=w>    </span><span class=nt>author</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Matthew Walker</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>title</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Harry Potter and the Methods of Rationality</span><span class=w></span>
<span class=w>    </span><span class=nt>author</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Eliezer Yudkowsky</span><span class=w></span>
</code></pre></div> <p><code>yamlfix</code> can be used both as command line tool and as a library.</p> <p>As a command line tool:</p> <div class=highlight><pre><span></span><code>$: yamlfix file.yaml
</code></pre></div> <p>As a library:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>yamlfix</span> <span class=kn>import</span> <span class=n>fix_files</span>

<span class=n>fix_files</span><span class=p>([</span><span class=s2>&quot;file.py&quot;</span><span class=p>])</span>
</code></pre></div> <p>If instead of reading from a file you want to fix the code saved into a variable, use <code>fix_code</code>:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>yamlfix</span> <span class=kn>import</span> <span class=n>fix_code</span>

<span class=n>source_code</span> <span class=o>=</span> <span class=s2>&quot;a: 1&quot;</span>

<span class=n>fixed_code</span> <span class=o>=</span> <span class=n>fix_code</span><span class=p>(</span><span class=n>source_code</span><span class=p>)</span>

<span class=k>assert</span> <span class=n>fixed_code</span> <span class=o>==</span> <span class=s2>&quot;---</span><span class=se>\n</span><span class=s2>a: 1</span><span class=se>\n</span><span class=s2>&quot;</span>
</code></pre></div> <h2 id=features>Features<a class=headerlink href=#features title="Permanent link">&para;</a></h2> <p><code>yamlfix</code> will do the following changes in your yaml source code per default:</p> <ul> <li>Add the header <code>---</code> to your file.</li> <li><a href=https://yamllint.readthedocs.io/en/stable/rules.html#module-yamllint.rules.truthy>Correct truthy strings</a>: 'True' -&gt; true, 'no' -&gt; 'false'</li> <li>Remove unnecessary apostrophes: <code>title: 'Why we sleep'</code> -&gt; <code>title: Why we sleep</code>.</li> <li><a href=https://yamllint.readthedocs.io/en/stable/rules.html#module-yamllint.rules.comments>Correct comments</a></li> <li>Ensure that there is exactly one newline at the end of each file, to comply with the <a href=https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap03.html#tag_03_206>POSIX standard</a>.</li> <li>Split long lines.</li> <li>Respect Jinja2 syntax.</li> <li>Ensure a <code>\n</code> exists at the end of the file.</li> <li>Convert short lists to flow-style <code>list: [item, item]</code></li> <li>Convert lists longer than line-width to block-style: <div class=highlight><pre><span></span><code><span class=nt>list</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">item</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">item</span><span class=w></span>
</code></pre></div></li> </ul> <h2 id=configuration>Configuration<a class=headerlink href=#configuration title="Permanent link">&para;</a></h2> <p><code>yamlfix</code> uses the <code>maison</code> library to find and parse configuration from standard locations, and can additionally be configured through environment variables.</p> <p>Any configuration found in the <a href=./reference/#yamlfix.model.YamlfixConfig>YamlfixConfig class</a> can be set through your projects <code>pyproject.toml</code>, a custom <code>toml</code>-file or through the environment by providing an environment variable like <code>{yamlfix_env_prefix}_{yamlfix_config_key}</code>.</p> <p>Configuration options that are provided through environment variables have higher priority than options provided through configuration files and will override those keys.</p> <p>All provided <a href=#configuration-options>configuration options</a>, be it through <code>pyproject.toml</code>, config-files or env-vars, will be parsed by <code>pydantic</code>, so the target value type (str, bool, int, etc.) will be enforced, even if the provided value has the wrong type (for example all env vars in linux systems are strings, but pydantic will parse them to bools/numbers where necessary).</p> <h3 id=auto-configure-through-pyprojecttoml>Auto-Configure through <code>pyproject.toml</code><a class=headerlink href=#auto-configure-through-pyprojecttoml title="Permanent link">&para;</a></h3> <p>The <code>maison</code> library will automatically pick up your <code>yamlfix</code> configuration through your projects <code>pyproject.toml</code>. It will look in the section named <code>tool.yamlfix</code> and apply the provided <a href=#configuration-options>configuration options</a>. For example:</p> <div class=highlight><pre><span></span><code><span class=c1># pyproject.toml</span><span class=w></span>

<span class=k>[tool.yamlfix]</span><span class=w></span>
<span class=n>allow_duplicate_keys</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=w></span>
<span class=n>line_length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>80</span><span class=w></span>
<span class=n>none_representation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;null&quot;</span><span class=w></span>
</code></pre></div> <h3 id=provide-config-files>Provide config-files<a class=headerlink href=#provide-config-files title="Permanent link">&para;</a></h3> <p>When running <code>yamlfix</code> as a standalone cli application it might be desireable to provide a config file containing just the configuration related to <code>yamlfix</code>. A cli-argument <code>-c</code> (<code>--config-file</code>) can be provided multiple times to read configuration values from <code>toml</code> formatted files. The rightmost value-files override the value-files preceding them, only trumped by environment variables. No section headers are necessary for these configuration files, as the expected behaviour is, that those files contain only configuration related to <code>yamlfix</code>. For example:</p> <div class=highlight><pre><span></span><code><span class=c1># run yamlfix with two config files</span>
yamlfix -c base.toml --config-file environment.toml file.yaml
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># base.toml</span><span class=w></span>
<span class=n>allow_duplicate_keys</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=w></span>
<span class=n>line_length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=w></span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># environment.toml</span><span class=w></span>
<span class=n>allow_duplicate_keys</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=w></span>
</code></pre></div> <p>These provided configuration files would result in a merged runtime-configuration of: <div class=highlight><pre><span></span><code><span class=c1># merged configuration</span><span class=w></span>
<span class=n>allow_duplicate_keys</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=w></span>
<span class=n>line_length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=w></span>
</code></pre></div></p> <h3 id=configure-environment-prefix>Configure environment prefix<a class=headerlink href=#configure-environment-prefix title="Permanent link">&para;</a></h3> <p>Per default <code>yamlfix</code>, when run through cli, will read any environment variable that starts with <code>YAMLFIX_</code> and apply it to the merged runtime-configuration object. This default value can be overridden with the cli-parameter <code>--env-prefix</code>. For example:</p> <div class=highlight><pre><span></span><code><span class=c1># set a configuration value with the default prefix</span>
<span class=nb>export</span> <span class=nv>YAMLFIX_LINE_LENGTH</span><span class=o>=</span><span class=s2>&quot;300&quot;</span>

<span class=c1># set a configuration value with the custom prefix</span>
<span class=nb>export</span> <span class=nv>MY_PREFIX_NONE_REPRESENTATION</span><span class=o>=</span><span class=s2>&quot;~&quot;</span>

<span class=c1># run yamlfix with a custom environment prefix</span>
yamlfix --env-prefix <span class=s2>&quot;MY_PREFIX&quot;</span> file.yaml
</code></pre></div> <p>These provided arguments and environment variables would result in a merged runtime-configuration of: <div class=highlight><pre><span></span><code><span class=c1># merged configuration</span><span class=w></span>
<span class=c1># default value for line_length stays at: 80</span><span class=w></span>
<span class=n>none_representation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;~&quot;</span><span class=w></span>
</code></pre></div></p> <h3 id=configuration-options>Configuration Options<a class=headerlink href=#configuration-options title="Permanent link">&para;</a></h3> <p>All fields configured in the <a href=./reference/#yamlfix.model.YamlfixConfig>YamlfixConfig class</a> can be provided through the means mentioned in <a href=#configuration>Configuration</a>. Here are the currently available configuration options with short examples on their impact to provided <code>yaml</code>-files.</p> <h4 id=allow-duplicate-keys>Allow Duplicate Keys<a class=headerlink href=#allow-duplicate-keys title="Permanent link">&para;</a></h4> <p>Default: <code>allow_duplicate_keys: bool = False</code><br> Environment variable override: <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>YAMLFIX_ALLOW_DUPLICATE_KEYS</span><span class=o>=</span><span class=s2>&quot;true&quot;</span>
</code></pre></div></p> <p>This option toggles the <a href=https://ruyaml.readthedocs.io/en/latest/api.html#duplicate-keys>ruyaml duplicate keys check</a>. With this setting set to <code>False</code>, <code>yamlfix</code> will throw an error if the same key is defined more than once in a mapping / dictionary. To allow using the same key, set this value to <code>True</code>. You might want to enable this option, if you want to use multiple yaml-anchor merge keys, instead of providing them as sequence / list elements - see: <a href=https://github.com/pycontribs/ruyaml/issues/43>https://github.com/pycontribs/ruyaml/issues/43</a></p> <h4 id=config-path>Config Path<a class=headerlink href=#config-path title="Permanent link">&para;</a></h4> <p>Default: <code>config_path: Optional[str] = None</code><br> Environment variable override: <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>YAMLFIX_CONFIG_PATH</span><span class=o>=</span><span class=s2>&quot;/etc/yamlfix/&quot;</span>
</code></pre></div></p> <p>Configure the base config-path that <code>maison</code> will look for a <code>pyproject.toml</code> configuration file. This path is traversed upwards until such a file is found.</p> <h4 id=explicit-document-start>Explicit Document Start<a class=headerlink href=#explicit-document-start title="Permanent link">&para;</a></h4> <p>Default: <code>explicit_start: bool = True</code><br> Environment variable override: <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>YAMLFIX_EXPLICIT_START</span><span class=o>=</span><span class=s2>&quot;true&quot;</span>
</code></pre></div></p> <p>Add or remove the explicit document start (<code>---</code>) for <code>yaml</code>-files. For example:</p> <p>Set to <code>true</code>: <div class=highlight><pre><span></span><code><span class=nn>---</span><span class=w></span>
<span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yamlfix</span><span class=w></span>
</code></pre></div></p> <p>Set to <code>false</code>: <div class=highlight><pre><span></span><code><span class=nt>project_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yamlfix</span><span class=w></span>
</code></pre></div></p> <h4 id=flow-style-sequence-lists>Flow-Style Sequence (Lists)<a class=headerlink href=#flow-style-sequence-lists title="Permanent link">&para;</a></h4> <p>Default: <code>flow_style_sequence: Optional[bool] = True</code><br> Environment variable override: <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>YAMLFIX_FLOW_STYLE_SEQUENCE</span><span class=o>=</span><span class=s2>&quot;true&quot;</span>
</code></pre></div></p> <p>Transform sequences (lists) to either flow-style, block-style or leave them as-is. If enabled <code>yamlfix</code> will also ensure, that flow-style lists are automatically converted to block-style if the resulting key+list elements would breach the line-length. For example:</p> <p>Set to <code>true</code> (flow-style): <div class=highlight><pre><span></span><code><span class=nn>---</span><span class=w></span>
<span class=nt>list</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>item</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>item</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>item</span><span class="p p-Indicator">]</span><span class=w></span>
</code></pre></div></p> <p>Set to <code>false</code> (block-style): <div class=highlight><pre><span></span><code><span class=nn>---</span><span class=w></span>
<span class=nt>list</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">item</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">item</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">item</span><span class=w></span>
</code></pre></div></p> <h4 id=indentation>Indentation<a class=headerlink href=#indentation title="Permanent link">&para;</a></h4> <p>Default: <code>indent_mapping: int = 2</code> <code>indent_offset: int = 2</code> <code>indent_sequence: int = 4</code> Environment variable override: <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>YAMLFIX_INDENT_MAPPING</span><span class=o>=</span><span class=s2>&quot;2&quot;</span>
<span class=nb>export</span> <span class=nv>YAMLFIX_INDENT_OFFSET</span><span class=o>=</span><span class=s2>&quot;2&quot;</span>
<span class=nb>export</span> <span class=nv>YAMLFIX_INDENT_SEQUENCE</span><span class=o>=</span><span class=s2>&quot;4&quot;</span>
</code></pre></div></p> <p>Provide the <code>ruyaml</code> configuration for indentation of mappings (dicts) and sequences (lists) and the indentation offset for elements. See the <code>ruyaml</code> configuration documentation: <a href=https://ruyaml.readthedocs.io/en/latest/detail.html#indentation-of-block-sequences>https://ruyaml.readthedocs.io/en/latest/detail.html#indentation-of-block-sequences</a></p> <h4 id=line-length-width>Line Length (Width)<a class=headerlink href=#line-length-width title="Permanent link">&para;</a></h4> <p>Default: <code>line_length: int = 80</code><br> Environment variable override: <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>YAMLFIX_LINE_LENGTH</span><span class=o>=</span><span class=s2>&quot;80&quot;</span>
</code></pre></div></p> <p>Configure the line-length / width configuration for <code>ruyaml</code>. With this configuration long multiline-strings will be wrapped at that point and flow-style lists will be converted to block-style if they are longer than the provided value.</p> <h4 id=none-representation><code>None</code> Representation<a class=headerlink href=#none-representation title="Permanent link">&para;</a></h4> <p>Default: <code>none_representation: str = ""</code><br> Environment variable override: <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>YAMLFIX_LINE_LENGTH</span><span class=o>=</span><span class=s2>&quot;&quot;</span>
</code></pre></div></p> <p>In <code>yaml</code>-files an absence of a value can be described in multiple canonical ways. This configuration enforces a user-defined representation for <code>None</code> values. For example:</p> <p>Valid <code>None</code> representation values are <code>(empty string)</code>, <code>null</code>, <code>Null</code>, <code>NULL</code>, <code>~</code>.</p> <p>Provided the source yaml file looks like this: <div class=highlight><pre><span></span><code><span class=nt>none_value1</span><span class=p>:</span><span class=w></span>
<span class=nt>none_value2</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class=w></span>
<span class=nt>none_value3</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Null</span><span class=w></span>
<span class=nt>none_value4</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">NULL</span><span class=w></span>
<span class=nt>none_value5</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">~</span><span class=w></span>
</code></pre></div></p> <p>The default behaviour (empty string) representation would look like this: <div class=highlight><pre><span></span><code><span class=nt>none_value1</span><span class=p>:</span><span class=w></span>
<span class=nt>none_value2</span><span class=p>:</span><span class=w></span>
<span class=nt>none_value3</span><span class=p>:</span><span class=w></span>
<span class=nt>none_value4</span><span class=p>:</span><span class=w></span>
<span class=nt>none_value5</span><span class=p>:</span><span class=w></span>
</code></pre></div></p> <p>With this option set to <code>none_representation="null"</code> it would look like this: <div class=highlight><pre><span></span><code><span class=nt>none_value1</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class=w></span>
<span class=nt>none_value2</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class=w></span>
<span class=nt>none_value3</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class=w></span>
<span class=nt>none_value4</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class=w></span>
<span class=nt>none_value5</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class=w></span>
</code></pre></div></p> <h4 id=quote-basic-values>Quote Basic Values<a class=headerlink href=#quote-basic-values title="Permanent link">&para;</a></h4> <p>Default: <code>quote_basic_values: bool = False</code><br> Environment variable override: <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>YAMLFIX_quote_basic_values</span><span class=o>=</span><span class=s2>&quot;false&quot;</span>
</code></pre></div></p> <p>Per default <code>ruyaml</code> will quote only values where it is necessary to explicitly define the type of a value. This is the case for numbers and boolean values for example. If your <code>yaml</code>-file contains a value of type string that would look like a number, then this value needs to be quoted.</p> <p>This option allows for quoting of all simple values in mappings (dicts) and sequences (lists) to enable a homogeneous look and feel for string lists / simple key/value mappings. For example:</p> <div class=highlight><pre><span></span><code><span class=c1># option set to false</span><span class=w></span>
<span class=nt>stringKey1</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">abc</span><span class=w></span>
<span class=nt>stringKey2</span><span class=p>:</span><span class=w> </span><span class=s>&quot;123&quot;</span><span class=w></span>
<span class=nt>stringList</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>abc</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;123&quot;</span><span class="p p-Indicator">]</span><span class=w></span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># option set to true</span><span class=w></span>
<span class=nt>stringKey1</span><span class=p>:</span><span class=w> </span><span class=s>&quot;abc&quot;</span><span class=w></span>
<span class=nt>stringKey2</span><span class=p>:</span><span class=w> </span><span class=s>&quot;123&quot;</span><span class=w></span>
<span class=nt>stringList</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;abc&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;123&quot;</span><span class="p p-Indicator">]</span><span class=w></span>
</code></pre></div> <h4 id=quote-keys-and-basic-values>Quote Keys and Basic Values<a class=headerlink href=#quote-keys-and-basic-values title="Permanent link">&para;</a></h4> <p>Default: <code>quote_keys_and_basic_values: bool = False</code><br> Environment variable override: <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>YAMLFIX_quote_keys_and_basic_values</span><span class=o>=</span><span class=s2>&quot;false&quot;</span>
</code></pre></div></p> <p>Similar to the <a href=#quote-basic-values>quote basic values</a> configuration option, this option, in addition to the values themselves, quotes the keys as well. For example:</p> <div class=highlight><pre><span></span><code><span class=c1># option set to false</span><span class=w></span>
<span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">value</span><span class=w></span>
<span class=nt>list</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>item</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>item</span><span class="p p-Indicator">]</span><span class=w></span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># option set to true</span><span class=w></span>
<span class=s>&quot;key&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;value&quot;</span><span class=w></span>
<span class=s>&quot;list&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;item&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;item&quot;</span><span class="p p-Indicator">]</span><span class=w></span>
</code></pre></div> <h4 id=quote-representation>Quote Representation<a class=headerlink href=#quote-representation title="Permanent link">&para;</a></h4> <p>Default: <code>quote_representation: str = "'"</code><br> Environment variable override: <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>YAMLFIX_quote_representation</span><span class=o>=</span><span class=s2>&quot;&#39;&quot;</span>
</code></pre></div></p> <p>Configure which quotation string is used for quoting values. For example:</p> <div class=highlight><pre><span></span><code><span class=c1># Option set to: &#39;</span><span class=w></span>
<span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=s>&#39;value&#39;</span><span class=w></span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># Option set to: &quot;</span><span class=w></span>
<span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;value&quot;</span><span class=w></span>
</code></pre></div> <h2 id=references>References<a class=headerlink href=#references title="Permanent link">&para;</a></h2> <p>As most open sourced programs, <code>yamlfix</code> is standing on the shoulders of giants, namely:</p> <p><a href=https://github.com/mmlb/yamlfmt>yamlfmt</a> : Inspiration and alternative of this program. I created a new one because the pace of their pull requests is really slow, they don't have tests, CI pipelines or documentation.</p> <p><a href=https://github.com/pycontribs/ruyaml>ruyaml</a> : A git based community maintained for of <a href=https://yaml.readthedocs.io/en/latest/ >ruamel</a> yaml parser.</p> <p><a href=https://click.palletsprojects.com/ >Click</a> : Used to create the command line interface.</p> <p><a href=https://github.com/dbatten5/maison>maison</a> : Used for finding, reading and parsing the configuration options.</p> <p><a href=https://docs.pytest.org/en/latest>Pytest</a> : Testing framework, enhanced by the awesome <a href=https://smarie.github.io/python-pytest-cases/ >pytest-cases</a> library that made the parametrization of the tests a lovely experience.</p> <p><a href=https://mypy.readthedocs.io/en/stable/ >Mypy</a> : Python static type checker.</p> <p><a href=https://github.com/flakeheaven/flakeheaven>Flakeheaven</a> : Python linter with <a href=https://lyz-code.github.io/blue-book/devops/flakeheaven#plugins>lots of checks</a>.</p> <p><a href=https://black.readthedocs.io/en/stable/ >Black</a> : Python formatter to keep a nice style without effort.</p> <p><a href=https://lyz-code.github.io/autoimport>Autoimport</a> : Python formatter to automatically fix wrong import statements.</p> <p><a href=https://github.com/timothycrosley/isort>isort</a> : Python formatter to order the import statements.</p> <p><a href=https://pdm.fming.dev/ >PDM</a> : Command line tool to manage the dependencies.</p> <p><a href=https://www.mkdocs.org/ >Mkdocs</a> : To build this documentation site, with the <a href=https://squidfunk.github.io/mkdocs-material>Material theme</a>.</p> <p><a href=https://github.com/pyupio/safety>Safety</a> : To check the installed dependencies for known security vulnerabilities.</p> <p><a href=https://bandit.readthedocs.io/en/latest/ >Bandit</a> : To finds common security issues in Python code.</p> <h2 id=contributing>Contributing<a class=headerlink href=#contributing title="Permanent link">&para;</a></h2> <p>For guidance on setting up a development environment, and how to make a contribution to <code>yamlfix</code>, see <a href=https://lyz-code.github.io/yamlfix/contributing>Contributing to yamlfix</a>.</p> <h2 id=donations>Donations<a class=headerlink href=#donations title="Permanent link">&para;</a></h2> <p><a href=https://liberapay.com/Lyz/donate><img alt="Donate using
Liberapay" src=https://liberapay.com/assets/widgets/donate.svg></a> or <a href=https://ko-fi.com/T6T3GP0V8><img alt=ko-fi src=https://ko-fi.com/img/githubbutton_sm.svg></a></p> <p>If you are using some of my open-source tools, have enjoyed them, and want to say "thanks", this is a very strong way to do it.</p> <p>If your product/company depends on these tools, you can sponsor me to ensure I keep happily maintaining them.</p> <p>If these tools are helping you save money, time, effort, or frustrations; or they are helping you make money, be more productive, efficient, secure, enjoy a bit more your work, or get your product ready faster, this is a great way to show your appreciation. Thanks for that!</p> <p>And by sponsoring me, you are helping make these tools, that already help you, sustainable and healthy.</p> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2022-12-19T20:38:39+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2022-12-19</span> </small> </div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=editor_integration/ class="md-footer__link md-footer__link--next" aria-label="Next: Editor Integration" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Editor Integration </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": ".", "features": ["navigation.instant", "navigation.top", "content.code.annotate"], "search": "assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=assets/javascripts/bundle.6c7ad80a.min.js></script> <script src=js/timeago.min.js></script> <script src=js/timeago_mkdocs_material.js></script> </body> </html>